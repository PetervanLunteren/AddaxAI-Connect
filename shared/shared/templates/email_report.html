{% extends "base_email.html" %}

{% block title %}{{ project_name }} - {{ frequency }} report{% endblock %}

{% block header_content %}
<h1 style="font-size: 24px; font-weight: 600; margin: 0 0 4px 0; color: #0f6064;">{{ project_name }}</h1>
<p style="font-size: 16px; font-weight: 500; margin: 0; color: #1f2937;">{{ frequency }} report</p>
<p style="font-size: 14px; color: #6b7280; margin: 4px 0 0 0;">{{ period_label }}</p>
{% endblock %}

{% block content %}
<!-- Quick Stats -->
<table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td width="33%" align="center" style="padding: 10px;">
            <p style="font-size: 28px; font-weight: 700; color: #0f6064; line-height: 1.2; margin: 0;">{{ stats.new_images }}</p>
            <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">images</p>
        </td>
        <td width="33%" align="center" style="padding: 10px;">
            <p style="font-size: 28px; font-weight: 700; color: #0f6064; line-height: 1.2; margin: 0;">{{ stats.detections }}</p>
            <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">detections</p>
        </td>
        <td width="33%" align="center" style="padding: 10px;">
            <p style="font-size: 28px; font-weight: 700; color: #0f6064; line-height: 1.2; margin: 0;">{{ stats.species_count }}</p>
            <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">species</p>
        </td>
    </tr>
</table>
{% endblock %}

{% block extra_sections %}
{% if species and species|length > 0 %}
<!-- Top Species -->
<tr>
    <td style="padding: 24px; border-top: 1px solid #e5e7eb;">
        <h2 style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 16px 0;">Top species</h2>
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
            {% for sp in species[:5] %}
            <tr>
                <td width="30" style="padding: 10px 0; {% if not loop.last %}border-bottom: 1px solid #f3f4f6;{% endif %}">
                    <span style="font-size: 14px; font-weight: 600; color: #6b7280;">{{ loop.index }}.</span>
                </td>
                <td style="padding: 10px 0; {% if not loop.last %}border-bottom: 1px solid #f3f4f6;{% endif %}">
                    <span style="font-size: 15px; color: #1f2937;">{{ sp.species|replace('_', ' ')|title }}</span>
                </td>
                <td align="right" style="padding: 10px 0; {% if not loop.last %}border-bottom: 1px solid #f3f4f6;{% endif %}">
                    <span style="font-size: 15px; font-weight: 600; color: #0f6064;">{{ sp.count }}</span>
                </td>
            </tr>
            {% endfor %}
        </table>
    </td>
</tr>
{% endif %}

<!-- Camera Health -->
<tr>
    <td style="padding: 24px; border-top: 1px solid #e5e7eb;">
        <h2 style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 16px 0;">Cameras</h2>
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
            <tr>
                <td>
                    {% if cameras.inactive == 0 and cameras.low_battery_count == 0 %}
                    <span style="color: #0f6064; font-weight: 600;">&#10003; {{ cameras.active }}/{{ cameras.total }} active</span>
                    {% else %}
                    <span style="color: #882000; font-weight: 600;">{{ cameras.active }}/{{ cameras.total }} active</span>
                    {% endif %}
                    {% if cameras.avg_battery > 0 %}
                    &nbsp;&nbsp;
                    <span style="font-size: 14px; color: #6b7280;">Avg battery {{ cameras.avg_battery }}%</span>
                    {% endif %}
                    {% if cameras.avg_sd > 0 %}
                    &nbsp;&nbsp;
                    <span style="font-size: 14px; color: #6b7280;">Avg SD {{ cameras.avg_sd }}%</span>
                    {% endif %}
                </td>
            </tr>
        </table>

        {% if cameras.low_battery_count > 0 or cameras.inactive > 0 %}
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin-top: 12px;">
            <tr>
                <td style="background: #fff5f0; border-left: 3px solid #882000; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                    {% if cameras.low_battery_count > 0 %}
                    <p style="font-size: 13px; font-weight: 600; color: #882000; margin: 0 0 4px 0;">Low battery ({{ cameras.low_battery_count }})</p>
                    <p style="font-size: 13px; color: #882000; margin: 0;">
                        {% for cam in cameras.low_battery_cameras[:3] %}
                        {{ cam.name }} ({{ cam.battery }}%){% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                    {% endif %}
                    {% if cameras.inactive > 0 %}
                    <p style="font-size: 13px; font-weight: 600; color: #882000; margin: {% if cameras.low_battery_count > 0 %}8px{% else %}0{% endif %} 0 0 0;">Inactive ({{ cameras.inactive }})</p>
                    {% endif %}
                </td>
            </tr>
        </table>
        {% endif %}
    </td>
</tr>
{% endblock %}

{% block cta %}
<tr>
    <td align="center" style="padding: 24px; border-top: 1px solid #e5e7eb;">
        <table role="presentation" cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td style="background: #0f6064; border-radius: 8px;">
                    <a href="{{ project_url }}" style="display: inline-block; padding: 14px 32px; font-size: 15px; font-weight: 600; color: #ffffff; text-decoration: none;">Visit project</a>
                </td>
            </tr>
        </table>
    </td>
</tr>
{% endblock %}

{% block footer_link %}
<p style="margin: 0;"><a href="{{ settings_url }}" style="color: #0f6064; text-decoration: none;">Manage notification settings</a></p>
{% endblock %}
