{% extends "base_email.html" %}

{% block title %}{{ project_name }} - {{ frequency }} report{% endblock %}

{% block header_content %}
<h1 style="font-size: 24px; font-weight: 600; margin: 0 0 4px 0; color: #0f6064;">{{ project_name }}</h1>
<p style="font-size: 16px; font-weight: 500; margin: 0; color: #1f2937;">{{ frequency }} report</p>
<p style="font-size: 14px; color: #6b7280; margin: 4px 0 0 0;">{{ period_label }}</p>
{% endblock %}

{% block content %}
<!-- Quick Stats -->
<table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td width="33%" align="center" style="padding: 10px;">
            <p style="font-size: 28px; font-weight: 700; color: #0f6064; line-height: 1.2; margin: 0;">{{ stats.new_images }}</p>
            <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">images</p>
        </td>
        <td width="33%" align="center" style="padding: 10px;">
            <p style="font-size: 28px; font-weight: 700; color: #0f6064; line-height: 1.2; margin: 0;">{{ stats.detections }}</p>
            <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">detections</p>
        </td>
        <td width="33%" align="center" style="padding: 10px;">
            <p style="font-size: 28px; font-weight: 700; color: #0f6064; line-height: 1.2; margin: 0;">{{ stats.species_count }}</p>
            <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">species</p>
        </td>
    </tr>
</table>
{% endblock %}

{% block extra_sections %}
{% if species and species|length > 0 %}
<!-- Top Species -->
<tr>
    <td style="padding: 24px; border-top: 1px solid #e5e7eb;">
        <h2 style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 16px 0;">Top species</h2>
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
            {% for sp in species[:5] %}
            <tr>
                <td width="30" style="padding: 10px 0; {% if not loop.last %}border-bottom: 1px solid #f3f4f6;{% endif %}">
                    <span style="font-size: 14px; font-weight: 600; color: #6b7280;">{{ loop.index }}.</span>
                </td>
                <td style="padding: 10px 0; {% if not loop.last %}border-bottom: 1px solid #f3f4f6;{% endif %}">
                    <span style="font-size: 15px; color: #1f2937;">{{ sp.species|replace('_', ' ')|title }}</span>
                </td>
                <td align="right" style="padding: 10px 0; {% if not loop.last %}border-bottom: 1px solid #f3f4f6;{% endif %}">
                    <span style="font-size: 15px; font-weight: 600; color: #0f6064;">{{ sp.count }}</span>
                </td>
            </tr>
            {% endfor %}
        </table>
    </td>
</tr>
{% endif %}

<!-- Camera Health -->
<tr>
    <td style="padding: 24px; border-top: 1px solid #e5e7eb;">
        <h2 style="font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 16px 0;">Cameras</h2>
        <!-- Camera Stats Grid -->
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
            <tr>
                <td width="25%" align="center" style="padding: 10px;">
                    <p style="font-size: 28px; font-weight: 700; color: #0f6064; line-height: 1.2; margin: 0;">{{ cameras.total }}</p>
                    <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">cameras</p>
                </td>
                <td width="25%" align="center" style="padding: 10px;">
                    <p style="font-size: 28px; font-weight: 700; color: {% if cameras.inactive > 0 %}#882000{% else %}#0f6064{% endif %}; line-height: 1.2; margin: 0;">{{ cameras.active }}</p>
                    <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">active</p>
                </td>
                <td width="25%" align="center" style="padding: 10px;">
                    <p style="font-size: 28px; font-weight: 700; color: {% if cameras.low_battery_count > 0 %}#882000{% else %}#0f6064{% endif %}; line-height: 1.2; margin: 0;">{{ cameras.avg_battery }}%</p>
                    <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">battery</p>
                </td>
                <td width="25%" align="center" style="padding: 10px;">
                    <p style="font-size: 28px; font-weight: 700; color: {% if cameras.high_sd_count > 0 %}#882000{% else %}#0f6064{% endif %}; line-height: 1.2; margin: 0;">{{ cameras.avg_sd }}%</p>
                    <p style="font-size: 12px; color: #6b7280; margin: 2px 0 0 0;">SD used</p>
                </td>
            </tr>
        </table>

        {% if cameras.low_battery_count > 0 or cameras.high_sd_count > 0 or cameras.inactive > 0 %}
        <!-- Warning details -->
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin-top: 12px;">
            <tr>
                <td style="background: #fff5f0; border-left: 3px solid #882000; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                    {% if cameras.low_battery_count > 0 %}
                    <p style="font-size: 13px; font-weight: 600; color: #882000; margin: 0 0 4px 0;">Low battery ({{ cameras.low_battery_count }})</p>
                    <p style="font-size: 13px; color: #882000; margin: 0;">
                        {% for cam in cameras.low_battery_cameras[:3] %}
                        {{ cam.name }} ({{ cam.battery }}%){% if not loop.last %}, {% endif %}
                        {% endfor %}
                        {% if cameras.low_battery_count > 3 %}...{% endif %}
                    </p>
                    {% endif %}
                    {% if cameras.high_sd_count > 0 %}
                    <p style="font-size: 13px; font-weight: 600; color: #882000; margin: {% if cameras.low_battery_count > 0 %}8px{% else %}0{% endif %} 0 4px 0;">High SD usage ({{ cameras.high_sd_count }})</p>
                    <p style="font-size: 13px; color: #882000; margin: 0;">
                        {% for cam in cameras.high_sd_cameras[:3] %}
                        {{ cam.name }} ({{ cam.sd_percent }}%){% if not loop.last %}, {% endif %}
                        {% endfor %}
                        {% if cameras.high_sd_count > 3 %}...{% endif %}
                    </p>
                    {% endif %}
                    {% if cameras.inactive > 0 %}
                    <p style="font-size: 13px; font-weight: 600; color: #882000; margin: {% if cameras.low_battery_count > 0 or cameras.high_sd_count > 0 %}8px{% else %}0{% endif %} 0 4px 0;">Inactive ({{ cameras.inactive }})</p>
                    <p style="font-size: 13px; color: #882000; margin: 0;">
                        {% for cam in cameras.inactive_cameras[:3] %}
                        {{ cam.name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                        {% if cameras.inactive > 3 %}...{% endif %}
                    </p>
                    {% endif %}
                </td>
            </tr>
        </table>
        {% else %}
        <!-- All healthy -->
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin-top: 12px;">
            <tr>
                <td style="background: rgba(15, 96, 100, 0.1); border-left: 3px solid #0f6064; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                    <p style="font-size: 13px; font-weight: 600; color: #0f6064; margin: 0;">&#10003; All cameras OK</p>
                </td>
            </tr>
        </table>
        {% endif %}
    </td>
</tr>
{% endblock %}

{% block cta %}
<tr>
    <td align="center" style="padding: 24px; border-top: 1px solid #e5e7eb;">
        <table role="presentation" cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td style="background: #0f6064; border-radius: 8px;">
                    <a href="{{ project_url }}" style="display: inline-block; padding: 14px 32px; font-size: 15px; font-weight: 600; color: #ffffff; text-decoration: none;">Visit project</a>
                </td>
            </tr>
        </table>
    </td>
</tr>
{% endblock %}

{% block footer_link %}
<p style="margin: 0;"><a href="{{ settings_url }}" style="color: #0f6064; text-decoration: none;">Manage notification settings</a></p>
{% endblock %}
