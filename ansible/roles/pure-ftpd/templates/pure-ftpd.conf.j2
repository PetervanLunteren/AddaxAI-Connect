# Pure-FTPd configuration for AddaxAI Connect
# FTPS server for camera trap image uploads

############################################################
#                                                          #
#         Configuration file for pure-ftpd wrappers        #
#                                                          #
############################################################

# If you want to run Pure-FTPd with this configuration
# instead of command-line options, please run the
# following command :
#
# /usr/sbin/pure-ftpd /etc/pure-ftpd/pure-ftpd.conf
#
# Online documentation:
# https://www.pureftpd.org/project/pure-ftpd/doc

# Restrict users to their home directories (chroot)
ChrootEveryone              yes

# Break symbolic links if they go outside the chrooted jail
BrokenClientsCompatibility  no

# Maximum number of simultaneous users
MaxClientsNumber            10

# Fork in background
Daemonize                   yes

# Maximum number of simultaneous clients with the same IP address
MaxClientsPerIP             5

# Enable verbose log file (for debugging)
VerboseLog                  no

# Display dot-files starting with a dot, even when the client
# doesn't send "-a"
DisplayDotFiles             yes

# Don't allow authenticated users - have a public anonymous FTP account
# only
AnonymousOnly               no

# Do not allow anonymous connections. Only allow authenticated users
NoAnonymous                 yes

# Syslog facility (auth, authpriv, daemon, ftp, security, user, local*)
# The default facility is "ftp". "none" disables logging.
SyslogFacility              ftp

# Display fortune cookies
# FortunesFile              /usr/share/fortune/zippy

# Do not resolve host names in log files. Logs are less verbose, but
# it uses less bandwidth. Set this to "yes" on busy servers where
# reverse DNS lookups are slow.
DontResolve                 yes

# Maximum idle time in minutes (default = 15 minutes)
MaxIdleTime                 15

# LDAP configuration file (see README.LDAP)
# LDAPConfigFile                /etc/pure-ftpd/pureftpd-ldap.conf

# MySQL configuration file (see README.MySQL)
# MySQLConfigFile               /etc/pure-ftpd/pureftpd-mysql.conf

# PostgreSQL configuration file (see README.PGSQL)
# PGSQLConfigFile               /etc/pure-ftpd/pureftpd-pgsql.conf

# PureDB user database (see README.Virtual-Users)
# PureDB                        /etc/pure-ftpd/pureftpd.pdb

# Path to pure-authd socket (see README.Authentication-Modules)
# ExtAuth                       /var/run/ftpd.sock

# If you want to enable PAM authentication, uncomment the following line
PAMAuthentication             yes

# If you want simple Unix (/etc/passwd) authentication, uncomment this
UnixAuthentication            yes

# Please note that LDAPConfigFile, MySQLConfigFile, PAMAuthentication and
# UnixAuthentication can be used only once, but they can be combined
# together.

# 'ls' recursion limits. The first argument is the maximum number of
# files to be displayed. The second one is the max subdirectories depth
LimitRecursion              10000 8

# Are anonymous users allowed to create new directories?
AnonymousCanCreateDirs      no

# If the system is more loaded than the following value,
# anonymous users are not allowed to download.
MaxLoad                     4

# Port range for passive connections replies. - for firewalling.
PassivePortRange          {{ ftps_passive_port_min | default('40000') }} {{ ftps_passive_port_max | default('50000') }}

# Force an IP address in PASV/EPSV/SPSV replies. - for NAT.
# Symbolic host names are also accepted for gateways with dynamic IP
# addresses.
ForcePassiveIP              {{ ansible_host }}

# Upload/download ratio for anonymous users.
# AnonymousRatio                1 10

# Upload/download ratio for all users.
# This directive supersedes the previous one.
# UserRatio                 1 10

# Disallow downloading of files owned by "ftp", ie.
# files that were uploaded but not validated by a local admin.
AntiWarez                   yes

# IP address/port to listen to (default=all IP and port 21).
# Bind                      127.0.0.1,21

# Maximum bandwidth for anonymous users in KB/s
# AnonymousBandwidth            8

# Maximum bandwidth for *all* users (including anonymous) in KB/s
# Use AnonymousBandwidth *or* UserBandwidth, both makes no sense.
# UserBandwidth             8

# File creation mask. <umask for files>:<umask for dirs> .
# 177:077 if you feel paranoid.
Umask                       133:022

# Minimum UID for an authenticated user to log in.
MinUID                      1000

# Allow FXP transfers for authenticated users.
AllowUserFXP                no

# Allow anonymous FXP for anonymous and non-anonymous users.
AllowAnonymousFXP           no

# Users can't delete/write files beginning with a dot ('.')
# even if they own them. If TrustedGID is enabled, this group
# will have access to dot-files, though.
ProhibitDotFilesWrite       no

# Prohibit *reading* of files beginning with a dot (.history, .ssh...)
ProhibitDotFilesRead        no

# Never overwrite files. When a file whose name already exist is uploaded,
# it get automatically renamed to file.1, file.2, file.3, ...
# THIS IS THE AUTO-RENAME FEATURE
AutoRename                  yes

# Disallow anonymous users to upload new files (no = upload is allowed)
AnonymousCantUpload         yes

# Only connections to this specific IP address are allowed to be
# non-anonymous. You can use this directive to open several public IPs for
# anonymous FTP, and keep a private firewalled IP for remote administration.
# You can also only allow a non-routable local IP (like 10.x.x.x) to
# authenticate, and keep a public IP only for anonymous FTP. See also
# the 'Bind' directive.
# TrustedIP                  10.1.1.1

# If you want to add the PID to every logged line, uncomment the following
# line.
# LogPID                     yes

# Create an additional log file with transfers logged in a Apache-like format :
# fw.c9x.org - jedi [13/Apr/2017:19:36:39] "GET /ftp/linux.tar.bz2" 200 21809338
# This log file can then be processed by www/analog.
# AltLog                     clf:/var/log/pure-ftpd/transfer.log

# Create an additional log file with transfers logged in Stats19 format:
# http://www.webhostingtalk.com/showthread.php?s=&threadid=115965
# AltLog                     stats:/var/log/pure-ftpd/transfer.log

# Create an additional log file with transfers logged in a W3C-like format:
# (compatible with most commercial log analyzers)
# AltLog                     w3c:/var/log/pure-ftpd/transfer.log

# Disallow the CHMOD command. Users can't change perms of their files.
# NoChmod                     yes

# Allow users to resume and upload files, but *NOT* to delete them.
# KeepAllFiles                yes

# Automatically create home directories if they are missing
CreateHomeDir               no

# Enable virtual quotas. The first number is the max number of files.
# The second number is the max size of megabytes.
# So 1000:10 limits every user to 1000 files and 10 Mb.
# Quota                       1000:10

# If your pure-ftpd has been compiled with standalone support, you can change
# the location of the pid file. The default is /var/run/pure-ftpd.pid
# PIDFile                     /var/run/pure-ftpd.pid

# If your pure-ftpd has been compiled with pure-uploadscript support,
# this will make pure-ftpd write info about new uploads to
# /var/run/pure-ftpd.upload.pipe so pure-uploadscript can read it and
# spawn a script to handle the upload.
# Don't enable this option if you don't actually use pure-uploadscript.
# CallUploadScript yes

# This option is useful with servers where anonymous upload is
# allowed. When the partition is more that percententage full,
# new uploads are disallowed.
MaxDiskUsage               95

# Set to 'yes' to disallow usage of the ALLO command
# NoAllocate                  yes

# Be 'customer proof': forbids common customer mistakes such as
# 'chmod 0 public_html', that are valid, but can cause security headaches.
CustomerProof              yes

# Per-user concurrency limits. Will only work if the FTP server has
# been compiled with --with-peruserlimits.
# Format is: <max sessions per user>:<max anonymous sessions>
# For instance, 3:20 means that the same authenticated user can have 3 active
# sessions max. And there are 20 anonymous sessions max.
# PerUserLimits                3:20

# When a file is uploaded and there is already a previous version of the file
# with the same name, the old file will neither get removed nor truncated.
# Upload will take place in a temporary file and once the upload is complete,
# the switch to the new version will be atomic. This option will prevent
# temporary files from being visible by clients.
# THIS IS THE ATOMIC UPLOAD FEATURE
NoTruncate                  yes

# This option can accept three values:
# 0: disable SSL/TLS encryption layer (default).
# 1: accept both cleartext and encrypted sessions.
# 2: refuse any connection that is not using SSL/TLS encryption.
# 3: refuse connections that are not using SSL/TLS and also
#    refuse cleartext data transfers on encrypted channels.
TLS                         1

# Certificates for TLS
CertFile                    /etc/ssl/certs/pure-ftpd.crt
KeyFile                     /etc/ssl/private/pure-ftpd.key

# Listen only to IPv4 addresses in standalone mode (ie. disable IPv6)
# By default, both IPv4 and IPv6 are enabled.
# IPV4Only                    yes

# Listen only to IPv6 addresses in standalone mode (ie. disable IPv4)
# By default, both IPv4 and IPv6 are enabled.
# IPV6Only                    yes

# UTF-8 support for file names
# FileSystemCharset           big5

# Client charset for file name I/O
# ClientCharset               big5
